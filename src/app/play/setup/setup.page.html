<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar >
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>New Game</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar >
      <ion-title size="large">New Game</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="s-content-container">
    <!-- Player Selection -->
    <section class="sd-section-container">
      <ion-item class="sd-section-header" lines="full">
        <ion-label>
          <div style="display: flex; justify-content: space-between">
            <span>Players</span>
            <span>2+ players</span>
          </div>
        </ion-label>
      </ion-item>
      <ion-item lines="full" style="--background: var(--md-surfaceContainer)">
        <ion-label style="display: flex; align-items: center; gap: .5rem; justify-content: center;">
          <ion-icon style="font-size: 24px;" color="tertiary" name="information-circle"></ion-icon>
          <ion-note color="tertiary">Tap players in turn order</ion-note>
        </ion-label>
      </ion-item>
      <ion-list class="s-player-list" lines="none">
        @for (player of players; track player.id) {
          <ion-item button [detail]="false" (click)="handleSelectedPlayer(player.id!)">
            <ion-label>{{ player.name }}</ion-label>
            <ion-checkbox *ngIf="!selectedRosterIds.includes(player.id!)" slot="end"/>
            <ion-label *ngIf="selectedRosterIds.includes(player.id!)" slot="end" class="s-selection-indicator">
              {{ selectedRosterIds.indexOf(player.id!) + 1 }}
            </ion-label>
          </ion-item>
        }
      </ion-list>
    </section>

    <!-- House Rules -->
    <section class="sd-section-container">
      <ion-item class="sd-section-header" lines="full">
        <ion-label>House Rules</ion-label>
      </ion-item>
      <ion-list lines="none">
        <ion-item>
          <ion-input
            type="number"
            label="Target Score"
                        [(ngModel)]="rules.targetScore"
            [value]="rules.targetScore">
          </ion-input>
        </ion-item>
        <ion-item>
          <ion-input
            type="number"
            label="On-Board Threshold"
                        [(ngModel)]="rules.onBoardThreshold"
            [value]="rules.onBoardThreshold">
          </ion-input>
        </ion-item>
        <ion-item>
          <ion-toggle [checked]="rules.mustHitExactly" (ionChange)="handleMustHitExactlyChanged()">
            Hit Goal Exactly
          </ion-toggle>
        </ion-item>
        @if (rules.mustHitExactly) {
          <ion-item>
            <ion-select
              label="Overshoot Penalty"
                            [value]="rules.overshootPenaltyType"
              (ionChange)="onOvershootPenaltyChange($event)">
              <ion-select-option value="lose_full_bank">Lose Full Turn</ion-select-option>
              <ion-select-option value="lose_overshoot_only">Lose Overshoot Only</ion-select-option>
              <ion-select-option value="cap_at_target">Cap at Target</ion-select-option>
            </ion-select>
          </ion-item>
        }
        <ion-item>
          <ion-toggle [checked]="rules.allowCarryOverBank" (ionChange)="handleAllowCarryOverChanged()">
            Allow Carry-Over
          </ion-toggle>
        </ion-item>
      </ion-list>
    </section>

    <!-- Game Options -->
    <section class="sd-section-container">
      <ion-item class="sd-section-header" lines="full">
        <ion-label>Options</ion-label>
      </ion-item>
      <ion-list lines="none">
        <ion-item>
          <ion-toggle [checked]="startRandomPlayer" (ionChange)="handleStartRandomPlayer()">
            Random Starting Player
          </ion-toggle>
        </ion-item>
      </ion-list>
    </section>
  </div>

  <div class="ion-padding">
    <ion-button expand="block" [disabled]="selectedRosterIds.length < 2" (click)="startGame()">
      Start Game
    </ion-button>
  </div>

</ion-content>
