<ion-header [translucent]="true" class="ion-no-border">
  <ion-toolbar >
    <ion-buttons slot="start">
      <ion-back-button></ion-back-button>
    </ion-buttons>
    <ion-title>Settings</ion-title>
  </ion-toolbar>
</ion-header>

<ion-content [fullscreen]="true">
  <ion-header collapse="condense">
    <ion-toolbar >
      <ion-title size="large">Settings</ion-title>
    </ion-toolbar>
  </ion-header>

  <div class="s-content-container">
    @if (settings) {
      <!-- Default Game Rules -->
      <section class="sd-section-container">
        <ion-item class="sd-section-header" lines="full">
          <ion-label>Default Game Rules</ion-label>
        </ion-item>
        <ion-list lines="none">
          <ion-item>
            <ion-input
              type="number"
              label="Target Score"
              [value]="settings.defaultRules.targetScore"
              (ionChange)="targetScoreChanged($event)">
            </ion-input>
          </ion-item>

          <ion-item>
            <ion-input
              type="number"
              label="On-Board Threshold"
              [value]="settings.defaultRules.onBoardThreshold"
              (ionChange)="onBoardThresholdChanged($event)">
            </ion-input>
          </ion-item>

          <ion-item>
            <ion-toggle
              [checked]="settings.defaultRules.mustHitExactly"
              (ionChange)="mustHitExactlyChanged($event)">
              <ion-label>
                <h2>Hit Goal Exactly</h2>
                <ion-note class="ion-text-wrap">Can't exceed the target score</ion-note>
              </ion-label>
            </ion-toggle>
          </ion-item>

          @if (settings.defaultRules.mustHitExactly) {
            <ion-item>
              <ion-select
                label="Overshoot Penalty"
                [value]="settings.defaultRules.overshootPenaltyType"
                (ionChange)="overshootPenaltyChanged($event)">
                <ion-select-option value="lose_full_bank">Lose Full Turn</ion-select-option>
                <ion-select-option value="lose_overshoot_only">Lose Overshoot Only</ion-select-option>
                <ion-select-option value="cap_at_target">Cap at Target</ion-select-option>
              </ion-select>
            </ion-item>
          }

          <ion-item>
            <ion-toggle
              [checked]="settings.defaultRules.allowCarryOverBank"
              (ionChange)="allowCarryOverChanged($event)">
              <ion-label>
                <h2>Allow Carry-Over</h2>
                <ion-note class="ion-text-wrap">Can take previous player's banked points</ion-note>
              </ion-label>
            </ion-toggle>
          </ion-item>

        </ion-list>
      </section>

      <ion-button fill="clear" expand="block" color="secondary" class="reset-button" (click)="resetRulesToDefault()">
        <ion-icon slot="start" name="refresh"></ion-icon>
        Reset Rules to Default
      </ion-button>

      <!-- Account -->
      <section class="sd-section-container">
        <ion-item class="sd-section-header" lines="full">
          <ion-label>Account</ion-label>
        </ion-item>
        <ion-list lines="none">
          @if (isLoggedIn()) {
            <ion-item button (click)="syncData()">
              <ion-icon slot="start" name="cloud-upload"></ion-icon>
              <ion-label>
                <h2>Sync Data</h2>
                <ion-note class="ion-text-wrap">Backup your data to the cloud</ion-note>
              </ion-label>
            </ion-item>
            <ion-item button (click)="deleteAccount()">
              <ion-icon slot="start" name="trash"></ion-icon>
              <ion-label>
                <h2>Delete All Data</h2>
                <ion-note class="ion-text-wrap">Remove all local and cloud data</ion-note>
              </ion-label>
            </ion-item>
            <ion-item button (click)="logout()">
              <ion-icon slot="start" name="exit"></ion-icon>
              <ion-label>
                <h2>Sign Out</h2>
                <ion-note class="ion-text-wrap">{{ userEmail() }}</ion-note>
              </ion-label>
            </ion-item>
          } @else {
            <ion-item button (click)="login()">
              <ion-icon slot="start" name="log-in"></ion-icon>
              <ion-label>
                <h2>Sign In</h2>
                <ion-note class="ion-text-wrap">Sign in to sync data across devices</ion-note>
              </ion-label>
            </ion-item>
          }
        </ion-list>
      </section>

      <ion-item lines="none" class="ion-text-center">
        <ion-label>
          <ion-text color="medium">Version {{ version }}</ion-text>
        </ion-label>
      </ion-item>
    }
  </div>
</ion-content>
